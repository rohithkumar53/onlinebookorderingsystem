const { v4: uuidv4 } = require('uuid');
const stripe= require("stripe")(`${process.env.secretKey}`);
const Orders= require("../models/ordersModel");
exports.orderPayment= async (req, res)=>{
    try {
        const {token, amttopay, activeUser, book}= req.body;

        const user= await stripe.customers.create({
            email: token.email,
            description: "placing my books order",
            source: token.id
        });

        const payment= await stripe.charges.create({
            amount: amttopay*100,
            currency: 'gbp',
            customer: user.id,
            receipt_email: token.email

        }, {idempotencyKey: uuidv4()});

        if(payment){
            res.send("Payment made successfully!!!!");
        }

    } catch (error) {
        res.status(400).json({message: "Your payment has been failed!!"});
        
    }

}